# syntax = docker/dockerfile:1.3

FROM ubuntu:14.04

WORKDIR /server

COPY ./const-files .

RUN sudo mkdir -p /usr/lib/jvm
RUN tar -zxvf jre-8u181-linux-x64.tar.gz -C /usr/lib/jvm
RUN sudo update-alternatives --install "/usr/bin/java" "java" "/usr/lib/jvm/jre1.8.0_181/bin/java" 1
RUN rm jre-8u181-linux-x64.tar.gz

RUN mkdir -p /server/bqp
COPY ./cronjob.sh .

RUN cron
RUN (crontab -l ; echo "* * * * * /bin/bash /server/cronjob.sh") | crontab

COPY ./server .
RUN chmod +x start_server.sh


RUN adduser --disabled-password --gecos "" bodzio
RUN chown bodzio:bodzio -R .

RUN echo "To jest flaga :DDD Gratulacje! Wprowadź ją do weryfikatora w minecraft i poczekaj chwilkę...\nZapraszamy do chwilki wspólnej gry na serwerze <3\n8 2 3 7 9 1 4 6 5" > /usr/lib/jvm/jre1.8.0_181/lib/desktop/icons/LowContrast/16x16/mimetypes/flag.txt
RUN chmod 600 /usr/lib/jvm/jre1.8.0_181/lib/desktop/icons/LowContrast/16x16/mimetypes/flag.txt

EXPOSE 25565

CMD cron && su - bodzio -c "cd /server; /server/start_server.sh"
