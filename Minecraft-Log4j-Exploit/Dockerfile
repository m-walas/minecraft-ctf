# syntax = docker/dockerfile:1.3

FROM ubuntu:14.04

WORKDIR /server

COPY ./const-files .

RUN sudo mkdir -p /usr/lib/jvm
RUN tar -zxvf jre-8u181-linux-x64.tar.gz -C /usr/lib/jvm
RUN sudo update-alternatives --install "/usr/bin/java" "java" "/usr/lib/jvm/jre1.8.0_181/bin/java" 1

RUN mkdir -p /server/bqp
COPY ./cronjob.sh .

# ADD crontab /etc/cron.d/hello-cron
# RUN chmod 0644 /etc/cron.d/hello-cron
# RUN crontab /etc/cron.d/hello-cron
# RUN touch /var/log/cron.log

# # Run the command on container startup
# CMD cron && tail -f /var/log/cron.log

RUN (crontab -l ; echo "* * * * * /bin/bash /server/cronjob.sh") | crontab
RUN cron

COPY ./server .
RUN chmod +x start_server.sh

RUN adduser --disabled-password --gecos "" bodzio
RUN chown bodzio:bodzio -R .


USER bodzio
CMD ./start_server.sh

EXPOSE 25565